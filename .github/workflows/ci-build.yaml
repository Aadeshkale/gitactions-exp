on:
  push:
    branches:
      - main
env:
  current_branch: ${{  github.ref }} 
  job_id: ${{ github.run_number }}
  sha: ${{ github.sha }}
  
jobs:
  build:
    name: Build Image 
    runs-on: ubuntu-latest  
    steps:
    - uses: actions/checkout@v3
    - name: git-checkout
      run: |
        echo "git-checkout done"

    - name: create a custom tag   
      run: echo "IMG_TAG=$(echo $GITHUB_SHA | cut -c 1-6)"-$job_id >> $GITHUB_ENV
    
    - name: tag   
      run: echo "$IMG_TAG"
      
  
  # export IMG_TAG="$sha" | cut -c1-6
        
    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3
    - name: Build and push
      uses: docker/build-push-action@v5
      with:
        push: true
        tags: welcome-app:$IMG_TAG, welcome-app:latest